â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              PRUEBA CORREGIDA: SUGERENCIAS DE HORARIOS - 5-9 ENERO 2026            â•‘
â•‘                    (FIX: Se detecta festivo anual del 6 de enero)                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ðŸ“‹ DATOS REALES DE LA BASE DE DATOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FICHAJES REGISTRADOS:
  Lunes 5 (2026-01-05):      07:41 - 14:03 | 6.28h âœ“
  Martes 6 (2026-01-06):     ðŸ–ï¸ FESTIVO (Reyes - Anual)
  MiÃ©rcoles 7 (2026-01-07):  07:29 - 15:33 | 6.20h âœ“ â† HOY
  Jueves 8 (2026-01-08):     SIN REGISTROS
  Viernes 9 (2026-01-09):    SIN REGISTROS

FESTIVOS/AUSENCIAS:
  âœ“ 6 de enero = Reyes (Festivo anual que se repite cada aÃ±o)


ðŸ“Š ANÃLISIS DEL SISTEMA (SCHEDULE_SUGGESTIONS.PHP - CORREGIDO)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PASO 1: Cargar festivos de la semana (CORREGIDO)
  âœ“ Se cargan TODOS los festivos (sin filtro de fecha)
  âœ“ Se reconstruyen los festivos anuales para 2026
  âœ“ Se filtra por rango de semana DESPUÃ‰S de reconstruir
  â†’ Encontrados: 1 festivo en semana 5-9
     - 2026-01-06: holiday (Reyes - ANNUAL)

PASO 2: Calcular objetivo semanal (ajustado por festivos)
  Config base Mon-Thu:     7.65 h/dÃ­a Ã— 4 dÃ­as = 30.60 h
  Config base Viernes:     6.50 h (con pausa = 5.50h trabajados)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Objetivo bruto:                                  36.10 h
  Horas restadas (festivos):                       -7.65 h  â† MARTES ES FESTIVO
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ðŸŽ¯ OBJETIVO FINAL CORREGIDO:                     28.45 h  â† ANTES ERA 36.10h

PASO 3: Calcular horas ya trabajadas (hasta hoy 7 enero)
  Lunes 5:      6.28 h
  Martes 6:     0.00 h (FESTIVO - no se cuenta)
  MiÃ©rcoles 7:  6.20 h
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  âœ“ TOTAL TRABAJADO:       12.48 h

PASO 4: Calcular horas restantes (CORREGIDO)
  Objetivo:    28.45 h
  Trabajado:  -12.48 h
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  PENDIENTE:   15.97 h  â† ANTES ERA 21.78h (INCORRECTO)

PASO 5: Determinar dÃ­as disponibles (excluyendo festivos)
  Hoy es miÃ©rcoles (dÃ­a 3 de 5)
  Jueves (dÃ­a 4):  âœ“ DISPONIBLE (no es festivo, sin registros)
  Viernes (dÃ­a 5): âœ“ DISPONIBLE (no es festivo, sin registros)
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  DÃ­as donde se pueden sugerir horarios: 2

PASO 6: Distribuir horas restantes (CORREGIDO)
  Horas pendientes:    15.97 h
  DÃ­as disponibles:    2
  Promedio por dÃ­a:    15.97 Ã· 2 = 7.98 h/dÃ­a  â† ANTES ERA 10.89h


ðŸ• SUGERENCIAS DE HORARIOS GENERADAS (CORREGIDAS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Jueves 8 enero 2026:
  Entrada:        08:39
  Salida:         16:37
  Horas:          7.98 h (7:58)  â† ANTES: 10.89h
  Tipo jornada:   Jornada Continua (sin pausa comida)
  Confianza:      ALTA (8 registros histÃ³ricos en Ãºltimos 90 dÃ­as)

Viernes 9 enero 2026:
  Entrada:        07:42
  Salida:         15:40
  Horas:          7.98 h (7:58)  â† ANTES: 10.89h
  Tipo jornada:   Jornada Continua (sin pausa comida)
  Confianza:      ALTA (8 registros histÃ³ricos en Ãºltimos 90 dÃ­as)


ðŸ”§ BUG ENCONTRADO Y CORREGIDO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA:
  La consulta a BD filtraba festivos POR FECHA antes de reconstruir los anuales:
  
  SELECT date FROM holidays 
  WHERE date >= '2026-01-05' AND date <= '2026-01-11'
  
  Pero "Reyes" estaba registrado como "2025-01-06" (ANNUAL=1), asÃ­ que NO aparecÃ­a
  en el rango 2026-01-05 a 2026-01-11.

SOLUCIÃ“N:
  Cambiar la consulta para cargAR TODOS los festivos sin filtro de fecha,
  luego reconstruir los anuales para el aÃ±o en cuestiÃ³n, luego filtrar por rango:
  
  SELECT date FROM holidays
  WHERE (user_id = ? OR user_id IS NULL)
  
  Luego en PHP:
  - Para cada festivo anual: reconstruir fecha a 2026-01-06
  - Luego filtrar si estÃ¡ en rango de semana: 2026-01-05 a 2026-01-11 âœ“

UBICACIÃ“N DEL FIX:
  schedule_suggestions.php lÃ­neas 420-441


âœ… COMPARATIVA: ANTES vs DESPUÃ‰S
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

                           ANTES        DESPUÃ‰S      DIFERENCIA
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Festivos detectados           0            1          +1 (Reyes)
Objetivo semanal          36.10h        28.45h       -7.65h
Horas trabajadas          14.32h        12.48h       -1.84h
Horas pendientes          21.78h        15.97h       -5.81h
DÃ­as disponibles              2            2           (igual)
Horas por dÃ­a             10.89h         7.98h       -2.91h/dÃ­a
Jueves sugerido        19:24 (10:53)  16:37 (7:58)  -2:46 mÃ¡s temprano
Viernes sugerido       18:35 (10:53)  15:40 (7:58)  -2:55 mÃ¡s temprano


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… VERIFICACIÃ“N - IMPLEMENTACIÃ“N CORRECTA

âœ“ Carga de festivos anuales: Fixed
  - Ahora consulta TODOS los festivos sin filtro de fecha
  - Reconstruye correctamente festivos anuales
  - Filtra por rango de semana despuÃ©s

âœ“ Ajuste del objetivo semanal: Correcto
  - Resta 7.65h por el festivo del martes 6
  - Nuevo objetivo: 28.45h (en lugar de 36.10h)

âœ“ CÃ¡lculo de horas pendientes: Correcto
  - 28.45h objetivo - 12.48h trabajado = 15.97h
  - DistribuciÃ³n: 15.97h Ã· 2 dÃ­as = 7.98h/dÃ­a

âœ“ Sugerencias generadas: Correctas
  - Horarios mÃ¡s realistas (7.98h/dÃ­a en lugar de 10.89h/dÃ­a)
  - Permiten cumplir objetivo considerando el festivo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
